<?php include 'templates/footer.phtml'; ?>
<div class=" ceda-wrapper  plr">
    <div class="col-md-12 ceda-wrapper">
        <div class="row w100">
            <?php include "sidebar.phtml" ?>
            <div class="col-md-9 ceda-wrapper bg-right col-9-ceda">
                <div class="content-wrapper pt150">
                    <div class="right-header">
                        <div class="user-name"><span class="welcome">Hi,</span> <?= $_SESSION['name'] ?>!</div>
                    </div>

                </div>
                <!-- <div class="border-header"></div> -->
                <div class="content-wrapper bottom-content">


                    <div class="trans-box">
                        <div class="trans-box-left">
                            <div class="inner-left">
                                <div class="pending-left">Last Pending Transaction<span
                                            class="in-naira-left">(In <?= ucfirst($_SESSION['currency']) ?>)</span>
                                </div>
                                <div class="timer"><Span><img src="/assets/images/time.svg" alt=""></Span> <span
                                            id="clock">00:00:00</span>
                                </div>
                            </div>

                            <div class="trans-price-left"><?= $_SESSION['currency_sign'] ?> <?= number_format($pending['amount_to']) ?></div>

                        </div>

                        <div class="trans-box-right">
                            <div class="total">Total Successful Transactions <span
                                        class="in-naira-right">(In <?= ucfirst($_SESSION['currency']) ?>)</span></div>
                            <div class="trans-price-right"><?= $_SESSION['currency_sign'] ?> <?= number_format($total['total']) ?></div>
                        </div>
                    </div>

                    <div class="ceda-container">
                        <div class="ceda-rate">Ceda Rate</div>
                        <div class="border-header"></div>
                        <div class="rate-row">
                            <?php foreach ($exchange_rates as $exchange_rate) { ?>
                                <div class="single-rate">
                                    1 <?= $exchange_rate['currency_from'] ?> <span class="divider"><img
                                                src="/assets/images/<?= $exchange_rate['currency_from_iso'] ?>.svg"
                                                alt=""></span>
                                    <span class="price"><?= $exchange_rate['currency_to_sign'] ?><?= $exchange_rate['ceda_rate'] ?></span>
                                </div>
                            <?php } ?>
                            <!-- <div class="single-rate">
                                 1 GBP <span class="divider"><img src="/assets/images/uk.svg" alt=""></span> <span class="price">â‚¦767</span>
                             </div>
                             <div class="single-rate">
                                 1 EUR <span class="divider"><img src="/assets/images/eu.svg" alt=""></span> <span class="price">â‚¦645</span>
                             </div>-->
                        </div>


                    </div>


                    <form action="" method="post">
                        <div class="convert-local-currency">
                            <div class="ceda-rate">Convert Money</div>
                            <div class="upper-covert">

                                <div class="currency">
                                    <input type="number" class="price-from" id="entered_currency">
                                    <!--<div class="price-from no-border">30</div>-->
                                    <!--<select name="price_to" id="price_to" class="price_to">
                                        <option value="DOL">DOL</option>
                                        <option value="POU">POU</option>
                                        <option value="EU">EU</option>
                                    </select>-->
                                    <!--<select name="countries" id="price_to" class="price_to">
                                        <option value="usd">ðŸ‡ºðŸ‡¸&emsp;USD</option>
                                        <option value="pou">ðŸ‡¬ðŸ‡§&emsp;POU</option>
                                        <option value="eu">ðŸ‡ªðŸ‡º&emsp;EU</option>
                                    </select>-->
                                    <select name="countries" id="price_to" class="price_to">
                                        <?php foreach ($exchange_rates as $exchange_rate) { ?>
                                            <option value="<?= $exchange_rate['ceda_rate'] ?>">
                                                <?= $exchange_rate['currency_from_sign'] ?>&emsp;<?= $exchange_rate['currency_from'] ?></option>
                                        <?php } ?>
                                    </select>
                                </div>
                                <div class="loop"><img src="/assets/images/convert-in.svg" alt=""></div>
                                <div class="currency">
                                    <!--<input type="number" class="price-from" id="price_to" placeholder="Price to">-->
                                    <div class="price-from no-border" id="converted_price">0</div>
                                    <!--<select name="price_to" id="price_to" class="price_to">
                                        <option value="DOL">DOL</option>
                                        <option value="POU">POU</option>
                                        <option value="EU">EU</option>
                                    </select>-->
                                    <div class="price_to" id="price_to"><span><img
                                                    src="/assets/images/<?= $_SESSION['iso'] ?>.svg" alt=""
                                                    class="converted_to_img"></span><span class="capita"><?= $_SESSION['currency'] ?></span>
                                    </div>
                                </div>
                            </div>
                            <div class="trans-btn-wrapper">
                                <a href="#" class="trans-btn">Continue Transaction</a>
                            </div>
                        </div>
                    </form>

                    <div class="convert-local-currency pd-table table-responsive-md">
                        <div class="ceda-rate">Transactions</div>
                        <table class="table  table-borderless">
                            <thead>
                            <tr>
                                <th scope="col" class="blt">Description</th>
                                <th scope="col" class="blt">Date</th>
                                <th scope="col" class="blt">Amount</th>
                                <th scope="col" class="blt">Status</th>
                                <th scope="col" class="blt"></th>
                            </tr>
                            </thead>
                            <tbody class="bl item_listing">
                            <tr>
                                <td colspan="9" class="text-center">Loading...</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    //convertCurrency('30','185.27')
    $('#price_to').on('change', function () {
        let exchangeRate = $('#price_to').val();
        let input = $('#entered_currency').val();
        $('#converted_price').html(numberWithCommas(convertCurrency(input, exchangeRate)));
    })
    $('#entered_currency').keyup(function () {
        let exchangeRate = $('#price_to').val();
        let input = $('#entered_currency').val();
        $('#converted_price').html(numberWithCommas(convertCurrency(input, exchangeRate)));
    })
    $('.trans-btn').click(function (e) {
        e.preventDefault();
        let exchangeRate = $('#price_to').val();
        let input = $('#entered_currency').val();
        window.location.href = '/convert-money?am=' + encode(input) + "&eq=" + encode(String(convertCurrency(input, exchangeRate)));
    });

    function getData() {
        $.ajax({
            url: "/ajax/get_transaction",
            data: {},
            method: "POST",
            cache: false,
            dataType: "html"
        }).done(function (data) {
            $(".item_listing").html(data);
        });
    }

    getData();
    let time = '<?=$date_time?>';
    let now = '<?=$now?>';

    var countDownTarget = new Date(time).getTime() + 60 * 60 * 1000;
    if(time!=''){
        showClock(countDownTarget);
    }
    // console.log(new Date('Wed Jun 8 2022 22:42:12').getTime());

    function showClock(target) {
        const distance = target - new Date().getTime();
        let hours = distance < 0 ? 0 : Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        let mins = distance < 0 ? 0 : Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        let secs = distance < 0 ? 0 : Math.floor((distance % (1000 * 60)) / 1000);

        // Output the results
        if(isNaN(hours) ){
            hours = '00';
        }

        if(isNaN(mins) ){
            mins = '00'
        }
        if(isNaN(secs) ){
            secs ='00'
        }
        document.getElementById("clock").innerHTML = hours + ":" + mins + ":" + secs;
        //  document.getElementById("seconds").innerHTML = secs;
    }



    // Update the count down every 1 second
    var x = setInterval(function () {
        showClock(countDownTarget);
        if (countDownTarget - new Date().getTime() < 0) {
            clearInterval(x);
        }
    }, 1000);
</script>